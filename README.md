# –ó–∞–¥–∞–Ω–∏–µ

1. –ß—Ç–æ —Ç–∞–∫–æ–µ CI/CD?

### –û—Ç–≤–µ—Ç

CI/CD (Continuous Integration / Continuous Delivery –∏–ª–∏ Continuous Deployment) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–∫—Ç–∏–∫ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è.

2. –ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –¥–µ–º–æ–Ω –¥–ª—è systemd, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ —Å–ª—É—á–∞–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å—Ç—Ä–æ—è –ø—Ä–æ—Ü–µ—Å—Å–∞.

### –û—Ç–≤–µ—Ç

–°–æ–∑–¥–∞–¥–∏–º –ø—Ä–æ–º—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç, –∫–∞–∫ –¥–µ–º–æ–Ω:

```
#!/bin/bash

# –ü—Ä–æ—Å—Ç–æ–π –¥–µ–º–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Å—Ç–æ –ø–∏—à–µ—Ç –≤ –ª–æ–≥ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É
while true; do
    echo "$(date): –î–µ–º–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç..." >> /var/log/simple_daemon.log
    sleep 1
done
```
–°–¥–µ–ª–∞–µ–º –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```
sudo chmod +x /usr/local/bin/simple_daemon.sh
```

–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª /etc/systemd/system/simple_daemon.service:

```
[Unit]
Description=–ü—Ä–æ—Å—Ç–æ–π –¥–µ–º–æ–Ω —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
After=network.target

[Service]
Type=simple
ExecStart=/bin/bash /usr/local/bin/simple_daemon.sh
Restart=always
RestartSec=5
# –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ!)
WorkingDirectory=/tmp
# –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```
–ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ–Ω:

```
sudo systemctl daemon-reload                  # –ü–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é systemd
sudo systemctl enable simple_daemon.service   # –í–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl start simple_daemon.service    # –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ–Ω
sudo systemctl status simple_daemon.service   # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å

```
–í—ã–≤–æ–¥:

```
serg@debian:~/git/Test$ sudo systemctl status simple_daemon.service
‚óè simple_daemon.service - –ü—Ä–æ—Å—Ç–æ–π –¥–µ–º–æ–Ω —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
     Loaded: loaded (/etc/systemd/system/simple_daemon.service; enabled; preset: enabled)
     Active: active (running) since Mon 2025-04-21 10:41:19 MSK; 12min ago
   Main PID: 9614 (bash)
      Tasks: 2 (limit: 9461)
     Memory: 620.0K
        CPU: 2.325s
     CGroup: /system.slice/simple_daemon.service
             ‚îú‚îÄ 9614 /bin/bash /usr/local/bin/simple_daemon.sh
             ‚îî‚îÄ12570 sleep 1
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏:

```
tail -f /var/log/simple_daemon.log
```

```
Mon Apr 21 10:48:44 MSK 2025: –î–µ–º–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç...
Mon Apr 21 10:48:45 MSK 2025: –î–µ–º–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç...
Mon Apr 21 10:48:46 MSK 2025: –î–µ–º–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç...
```
–ï—Å–ª–∏ —É–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤—Ä—É—á–Ω—É—é, —Ç–æ –¥–µ–º–æ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫ –∏–∑-–∑–∞ Restart=always.

```
sudo kill 9614
```

3. –ß—Ç–æ —Ç–∞–∫–æ–µ inode –≤ Linux?

### –û—Ç–≤–µ—Ç

Inode (index node) ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö Linux/Unix, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Ñ–∞–π–ª–µ (–≤—Å—ë, –∫—Ä–æ–º–µ –∏–º–µ–Ω–∏ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ).

–ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç inode:

–¢–∏–ø —Ñ–∞–π–ª–∞ (–æ–±—ã—á–Ω—ã–π —Ñ–∞–π–ª, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, —Å–∏–º–≤–æ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –∏ —Ç.–¥.).

–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (rwx –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞, –≥—Ä—É–ø–ø—ã –∏ –¥—Ä—É–≥–∏—Ö).

UID/GID (–≤–ª–∞–¥–µ–ª–µ—Ü –∏ –≥—Ä—É–ø–ø–∞).

–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö.

–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ (–¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è, –¥–æ—Å—Ç—É–ø–∞).

–°—Å—ã–ª–∫–∏ –Ω–∞ –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ (–≥–¥–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ).

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂—ë—Å—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ñ–∞–π–ª.


–ú–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ inode-—ç—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞, –∞ –∏–º—è —Ñ–∞–π–ª–∞ - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫–ª–∏—á–∫–∞.

4. –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é blue/green —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞ –¥–ª—è Kubernetes –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–æ–≤, —Å–µ—Ä–≤–∏—Å–∞ –∏ ingress‚Äô–∞. –û–ø–∏—à–∏—Ç–µ –∫–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –≤–µ—Ä—Å–∏–∏.

### –û—Ç–≤–µ—Ç

–§–∞–π–ª deployment-blue.yaml:

```
app: my-app
    version: blue
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
      version: blue
  template:
    metadata:
      labels:
        app: my-app
        version: blue
    spec:
      containers:
      - name: app
        image: my-app:v1
        ports:
        - containerPort: 80
```
–§–∞–π–ª deployment-green.yaml:

```
metadata:
  name: app-green
  labels:
    version: green
spec:
  template:
    metadata:
      labels:
        version: green
    spec:
      containers:
      - image: my-app:v2
```

–ü—Ä–∏–º–µ–Ω—è–µ–º:

```
kubectl apply -f deployment-blue.yaml
kubectl apply -f deployment-green.yaml
```
–§–∞–π–ª service.yaml:

```
apiVersion: v1
kind: Service
metadata:
  name: app-service
spec:
  selector:
    app: my-app
    version: blue  # –ù–∞—á–∏–Ω–∞–µ–º —Å blue
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
```
–ü—Ä–∏–º–µ–Ω—è–µ–º:

```
kubectl apply -f service.yaml
```
–§–∞–π–ª ingress.yaml:

```
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
spec:
  rules:
  - host: my-app.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app-service
            port:
              number: 80
```
–ü—Ä–∏–º–µ–Ω—è–µ–º:

```
kubectl apply -f ingress.yaml
```
–ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ Green:

1. –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä Service:

```
kubectl patch service app-service -p '{"spec":{"selector":{"version":"green"}}}'
```

2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ:

```
kubectl get pods -l version=green
curl my-app.example.com
```
–ï—Å–ª–∏ Green —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ Blue:

```
kubectl patch service app-service -p '{"spec":{"selector":{"version":"blue"}}}'
```

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å helm.


```
# –ü—Ä–∏–º–µ—Ä —Å Helm
helm upgrade my-app --set deployment.version=green
```
–ü—Ä–æ–≤–µ—Ä–∫–∞:

```
kubectl get deployments,svc,pods,ingress
```

5. –ù–∞–ø–∏—à–∏—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è AWS S3 –±–∞–∫–µ—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤.

–ü—Ä–∏–º–µ—Ä –ø–æ–ª–∏—Ç–∏–∫–∏ (–ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è):

```
{
    "Version": "2012-10-17",
    "Id": "S3PolicyRestrictByIP",
    "Statement": [
        {
            "Sid": "AllowAccessFromTrustedIPs",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:*",
            "Resource": [
                "arn:aws:s3:::YOUR_BUCKET_NAME",
                "arn:aws:s3:::YOUR_BUCKET_NAME/*"
            ],
            "Condition": {
                "IpAddress": {
                    "aws:SourceIp": [
                        "192.0.2.0/24",   // –ü—Ä–∏–º–µ—Ä: —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–∞—è –ø–æ–¥—Å–µ—Ç—å
                        "203.0.113.42/32" // –ü—Ä–∏–º–µ—Ä: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π IP
                    ]
                }
            }
        },
        {
            "Sid": "DenyAllOtherIPs",
            "Effect": "Deny",
            "Principal": "*",
            "Action": "s3:*",
            "Resource": [
                "arn:aws:s3:::YOUR_BUCKET_NAME",
                "arn:aws:s3:::YOUR_BUCKET_NAME/*"
            ],
            "Condition": {
                "NotIpAddress": {
                    "aws:SourceIp": [
                        "192.0.2.0/24",
                        "203.0.113.42/32"
                    ]
                }
            }
        }
    ]
}
```
–ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É?

–ó–∞–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–¥–µ:

YOUR_BUCKET_NAME ‚Üí –∏–º—è –≤–∞—à–µ–≥–æ –±–∞–∫–µ—Ç–∞.

192.0.2.0/24, 203.0.113.42/32 ‚Üí –≤–∞—à–∏ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ IP/–ø–æ–¥—Å–µ—Ç–∏.

–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É –≤ –±–∞–∫–µ—Ç:

–û—Ç–∫—Ä–æ–π—Ç–µ AWS S3 Console ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –±–∞–∫–µ—Ç ‚Üí –≤–∫–ª–∞–¥–∫–∞ Permissions ‚Üí Bucket Policy.

–í—Å—Ç–∞–≤—å—Ç–µ JSON –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ.



–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ GetObject):
–ó–∞–º–µ–Ω–∏—Ç–µ "s3:*" –Ω–∞ "s3:GetObject".
–î–æ—Å—Ç—É–ø –¥–ª—è IAM-—Ä–æ–ª–µ–π/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–æ–π—Ç–∏ IP-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ):
–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ —Å "Principal": { "AWS": "arn:aws:iam::ACCOUNT_ID:user/NAME" }.

–í–∞–∂–Ω–æ!

–ï—Å–ª–∏ —É –±–∞–∫–µ—Ç–∞ –≤–∫–ª—é—á–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø, S3 –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —ç—Ç—É –ø–æ–ª–∏—Ç–∏–∫—É.
–û—Ç–∫–ª—é—á–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–∞–∫–µ—Ç–∞:
Permissions ‚Üí Block Public Access ‚Üí Enable all settings.

6. –û–±—ä—è—Å–Ω–∏—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã IaaS/PaaS/SaaS –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –ø–∏—Ü—Ü—ã.

1. IaaS (Infrastructure as a Service) ‚Äî "–°–æ–±–µ—Ä–∏ —Å–∞–º"

–í–∞–º –ø—Ä–∏–≤–æ–∑—è—Ç —Å—ã—Ä—É—é –ø–∏—Ü—Ü—É (—Ç–µ—Å—Ç–æ, —Å–æ—É—Å, —Å—ã—Ä, –Ω–∞—á–∏–Ω–∫–∏), –Ω–æ –ø–µ—á—å –∏ –Ω–∞—Ä–µ–∑–∞—Ç—å –Ω—É–∂–Ω–æ —Å–∞–º–æ–º—É.

–ß—Ç–æ –¥–µ–ª–∞–µ–º:

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä (–∫–∞–∫ –ø–µ—á—å –ø–∏—Ü—Ü—É).
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –û–°, –ü–û (–∫–∞–∫ –≤—ã–±–∏—Ä–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏ –≤—Ä–µ–º—è).
–£–ø—Ä–∞–≤–ª—è–µ—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é (–∫–∞–∫ —Ä–µ–∑–∞—Ç—å –∏ –ø–æ–¥–∞–≤–∞—Ç—å).

–ß—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä:

–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã (EC2), —Å–µ—Ç–∏, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (S3).

2. PaaS (Platform as a Service) ‚Äî "–ü—Ä–∏–≥–æ—Ç–æ–≤—å –∏–∑ –≥–æ—Ç–æ–≤—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤"

–í–∞–º –ø—Ä–∏–≤–æ–∑—è—Ç –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤—É—é –ø–∏—Ü—Ü—É, –Ω–æ –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ —Ç–æ–ø–ø–∏–Ω–≥–∏.

–ß—Ç–æ –¥–µ–ª–∞–µ–º:

–†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–≤—ã–±–∏—Ä–∞–µ—Ç–µ –Ω–∞—á–∏–Ω–∫—É).
–ù–µ –¥—É–º–∞–µ—Ç–µ –æ —Å–µ—Ä–≤–µ—Ä–∞—Ö, –û–° –∏ —Å–µ—Ç—è—Ö.

–ß—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä:

–ì–æ—Ç–æ–≤—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–¥–∞ (Heroku, App Engine).

–ì–æ—Ç–æ–≤—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–¥–∞

3. SaaS (Software as a Service) ‚Äî "–ü—Ä–æ—Å—Ç–æ –µ—à—å"

–í—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –≤ –ø–∏—Ü—Ü–µ—Ä–∏—é –∏ –µ–¥–∏—Ç–µ –≥–æ—Ç–æ–≤—É—é –ø–∏—Ü—Ü—É.

–ß—Ç–æ –¥–µ–ª–∞–µ–º:

–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑—É–µ—Ç–µ—Å—å (–Ω–∏–∫–∞–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏).

–ß—Ç–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä:

–ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã–π —Å–æ—Ñ—Ç (Gmail, Slack).

–í—ã–≤–æ–¥

    IaaS ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ (–∫–∞–∫ —Å—ã—Ä–∞—è –ø–∏—Ü—Ü–∞).

    PaaS ‚Äî –≤—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω—ã –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–∫–∞–∫ –≤—ã–±–æ—Ä —Ç–æ–ø–ø–∏–Ω–≥–æ–≤).

    SaaS ‚Äî –≤–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∫–∞–∫ –≥–æ—Ç–æ–≤–∞—è –ø–∏—Ü—Ü–∞).


üí° –ö–∞–∫ –∑–∞–ø–æ–º–Ω–∏—Ç—å?

    IaaS = "Infrastructure" (—Å–µ—Ä–≤–µ—Ä—ã, —Å–µ—Ç–∏) ‚Üí "–°–æ–±–µ—Ä–∏ —Å–∞–º".

    PaaS = "Platform" (–≥–æ—Ç–æ–≤—ã–π —Å—Ç–µ–∫ –¥–ª—è –∫–æ–¥–∞) ‚Üí "–î–æ–ø–∏–ª–∏ –Ω–∞—á–∏–Ω–∫—É".

    SaaS = "Software" (–≤–µ—Å—å —Å–æ—Ñ—Ç –≥–æ—Ç–æ–≤) ‚Üí "–ü—Ä–æ—Å—Ç–æ –µ—à—å".



7.     –ï—Å—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π Dockerfile, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –±—É–¥–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞. –ù—É–∂–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –µ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å best-practice

#–ø–ª–æ—Ö–æ–π —Ñ–∞–π–ª
FROM ubuntu:18.04
COPY ./src /app
RUN apt-get update -y
RUN apt-get install -y nodejs
RUN npm install
ENTRYPOINT [‚Äúnpm‚Äù]
CMD [‚Äúrun‚Äù, ‚Äúprod‚Äù]

### –û—Ç–≤–µ—Ç 

```
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–µ–≥–∫–∏–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ Node.js –Ω–∞ Alpine Linux
FROM node:18-alpine

# –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º package.json –∏ package-lock.json (–∏–ª–∏ yarn.lock)
COPY package*.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∫—ç—à–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ package.json –Ω–µ –º–µ–Ω—è–ª—Å—è)
RUN npm install --production

# –ö–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
COPY ./src ./

# –£–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
ENV NODE_ENV=production

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
CMD ["npm", "run", "prod"]
```

8. –° –ø–æ–º–æ—â—å—é —á–µ–≥–æ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤ Kubernetes —Å–µ—Ç–µ–≤–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø–æ–¥–∞–º–∏? –ü—Ä–∏–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä. –ù–∞–¥–æ –ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –¥–∞–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º?

### –û—Ç–≤–µ—Ç

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–µ–≤—ã–º —Ç—Ä–∞—Ñ–∏–∫–æ–º –º–µ–∂–¥—É –ø–æ–¥–∞–º–∏ –≤ Kubernetes –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è NetworkPolicy. –≠—Ç–æ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ, –∫–∞–∫–∏–µ –ø–æ–¥–∞ –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º, –∞ –∫–∞–∫–∏–µ ‚Äî –Ω–µ—Ç.


NetworkPolicy —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ (CNI), –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä:

Calico (–Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏)

Cilium (–Ω–∞ –±–∞–∑–µ eBPF, —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é)

Weave Net (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ NetworkPolicy)

kube-router

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ –≤–∞—à –∫–ª–∞—Å—Ç–µ—Ä NetworkPolicy:

```
kubectl get networkpolicies --all-namespaces
```
–ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –Ω–æ –æ—à–∏–±–æ–∫ –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç, NetworkPolicy –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ–ª–∏—Ç–∏–∫ –ø–æ–∫–∞ –Ω–µ—Ç.

9. –ß—Ç–æ —Ç–∞–∫–æ–µ POSIX?


POSIX (Portable Operating System Interface) ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏—Ö —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É Unix-–ø–æ–¥–æ–±–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏. –ï–≥–æ —Ü–µ–ª—å ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–ª—è –æ–¥–Ω–æ–π Unix-—Å–∏—Å—Ç–µ–º—ã, –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –Ω–∞ –¥—Ä—É–≥–∏—Ö –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

10. –ü—Ä–∏–≤–µ–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã DNS –∑–∞–ø–∏—Å–µ–π –∏ –¥–ª—è —á–µ–≥–æ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è?

### –û—Ç–≤–µ—Ç.

1. A-–∑–∞–ø–∏—Å—å (Address Record)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –°–≤—è–∑—ã–≤–∞–µ—Ç –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è —Å IPv4-–∞–¥—Ä–µ—Å–æ–º.

    –ü—Ä–∏–º–µ—Ä:
    example.com. A 192.0.2.1
    –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –¥–æ–º–µ–Ω example.com —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å IP 192.0.2.1.

2. AAAA-–∑–∞–ø–∏—Å—å (IPv6 Address Record)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞ A-–∑–∞–ø–∏—Å–∏, –Ω–æ –¥–ª—è IPv6-–∞–¥—Ä–µ—Å–æ–≤.

    –ü—Ä–∏–º–µ—Ä:
    example.com. AAAA 2001:db8::1
    –î–æ–º–µ–Ω example.com —Å–≤—è–∑–∞–Ω —Å IPv6-–∞–¥—Ä–µ—Å–æ–º 2001:db8::1.

3. CNAME-–∑–∞–ø–∏—Å—å (Canonical Name)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –°–æ–∑–¥–∞–µ—Ç –ø—Å–µ–≤–¥–æ–Ω–∏–º (–∞–ª–∏–∞—Å) –¥–ª—è –¥–æ–º–µ–Ω–∞, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—è –µ–≥–æ –Ω–∞ –¥—Ä—É–≥–æ–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è.
    –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, example.com ‚Üí –æ—à–∏–±–∫–∞).

    –ü—Ä–∏–º–µ—Ä:
    www.example.com. CNAME example.com.
    –ó–∞–ø—Ä–æ—Å –∫ www.example.com –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ example.com.

4. MX-–∑–∞–ø–∏—Å—å (Mail Exchange)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—á—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–µ email –¥–ª—è –¥–æ–º–µ–Ω–∞.
    –ß–µ–º –º–µ–Ω—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞, —Ç–µ–º –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞.

    –ü—Ä–∏–º–µ—Ä:
    example.com. MX 10 mail1.example.com.
    example.com. MX 20 mail2.example.com.
    –ü–æ—á—Ç–∞ –¥–ª—è example.com —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ mail1.example.com, –∑–∞—Ç–µ–º –Ω–∞ mail2.example.com.

5. TXT-–∑–∞–ø–∏—Å—å (Text Record)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

        SPF (–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è email).

        DKIM (—Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å –ø–∏—Å–µ–º).

        DMARC (–ø–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—á—Ç—ã).

        –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–ª–∞–¥–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è Google Search Console).

    –ü—Ä–∏–º–µ—Ä SPF:
    example.com. TXT "v=spf1 include:_spf.google.com ~all"

6. NS-–∑–∞–ø–∏—Å—å (Name Server)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–∫–∞–∑—ã–≤–∞–µ—Ç DNS-—Å–µ—Ä–≤–µ—Ä—ã, –æ—Ç–≤–µ—á–∞—é—â–∏–µ –∑–∞ –¥–æ–º–µ–Ω–Ω—É—é –∑–æ–Ω—É.

    –ü—Ä–∏–º–µ—Ä:
    example.com. NS ns1.example.com.
    example.com. NS ns2.example.com.
    DNS-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è example.com –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–∞–º–∏ ns1.example.com –∏ ns2.example.com.

7. SOA-–∑–∞–ø–∏—Å—å (Start of Authority)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –°–ª—É–∂–µ–±–Ω–∞—è –∑–∞–ø–∏—Å—å —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –æ –¥–æ–º–µ–Ω–Ω–æ–π –∑–æ–Ω–µ:

        –ü–µ—Ä–≤–∏—á–Ω—ã–π DNS-—Å–µ—Ä–≤–µ—Ä.

        Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

        –¢–∞–π–º–∏–Ω–≥–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ).

    –ü—Ä–∏–º–µ—Ä:
    plaintext

    example.com.    SOA    ns1.example.com. admin.example.com. (
                    2024022001 ; Serial number
                    3600       ; Refresh (1 hour)
                    1800       ; Retry (30 mins)
                    604800     ; Expire (1 week)
                    86400 )    ; TTL (1 day)

8. PTR-–∑–∞–ø–∏—Å—å (Pointer Record)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±—Ä–∞—Ç–Ω—ã–π DNS ‚Äî —Å–≤—è–∑—ã–≤–∞–µ—Ç IP-–∞–¥—Ä–µ—Å —Å –¥–æ–º–µ–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–Ω—Ç–∏—Å–ø–∞–º–∞ –∏ –ª–æ–≥–æ–≤.

    –ü—Ä–∏–º–µ—Ä:
    1.2.0.192.in-addr.arpa. PTR example.com.
    IP 192.0.2.1 —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–º–µ–Ω—É example.com.

9. SRV-–∑–∞–ø–∏—Å—å (Service Record)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –£–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–ª—É–∂–± (VoIP, LDAP, XMPP).
    –§–æ—Ä–º–∞—Ç: _—Å–µ—Ä–≤–∏—Å._–ø—Ä–æ—Ç–æ–∫–æ–ª.–¥–æ–º–µ–Ω.

    –ü—Ä–∏–º–µ—Ä –¥–ª—è SIP (VoIP):
    _sip._tcp.example.com. SRV 10 60 5060 sipserver.example.com.
    –ì–¥–µ:

        10 ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

        60 ‚Äî –≤–µ—Å.

        5060 ‚Äî –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞.

        sipserver.example.com. ‚Äî —Ü–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä.

10. CAA-–∑–∞–ø–∏—Å—å (Certification Authority Authorization)

    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ —Ü–µ–Ω—Ç—Ä—ã —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (CA) –º–æ–≥—É—Ç –≤—ã–ø—É—Å–∫–∞—Ç—å SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è –¥–æ–º–µ–Ω–∞.
    –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–ø—É—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

    –ü—Ä–∏–º–µ—Ä:
    example.com. CAA 0 issue "letsencrypt.org"
    –¢–æ–ª—å–∫–æ Let‚Äôs Encrypt –º–æ–∂–µ—Ç –≤—ã–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è example.com.